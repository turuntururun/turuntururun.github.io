import{_ as y}from"./Tile.e90a75ea.js";import{r as h,_ as f}from"./Board.68b584df.js";import{a as g}from"./axios.47b9d439.js";import{f as w,_,c as i,a as t,d as l,F as c,r as u,g as p,t as r,h as k,v as I,o as a,w as v}from"./entry.0504d745.js";import{C as S}from"./client.519e320b.js";const n=new S({brokerURL:"ws://turuntururun-falcon.us-west-2.elasticbeanstalk.com/falcon-websocket"});n.onWebSocketError=e=>{console.error("Error with websocket",e)};n.onStompError=e=>{console.error("Broker reported error: "+e.headers.message),console.error("Additional details: "+e.body)};const N=w({name:"multiplayer",data:()=>({boardKey:"boardKey",found:[],chips:[],score:{},session:{playing:!1,userId:h(8).join(""),userName:"Player "+h(2).join("")}}),mounted(){this.session.userId=localStorage.getItem("falcon-user-id")||this.session.userId,localStorage.setItem("falcon-user-id",this.session.userId),this.session.userName=localStorage.getItem("falcon-user-name")||this.session.userName,localStorage.setItem("falcon-user-name",this.session.userName),console.log("We are in board",this.boardId),g.get("http://turuntururun-falcon.us-west-2.elasticbeanstalk.com/board/"+this.boardId).then(e=>{this.score=e.data,console.log("get response",e),this.connect()}).catch(e=>{console.warn("Caught error",e),console.warn("Websocket not connected")})},beforeUnmount(){this.disconnect()},computed:{boardId(){return new URLSearchParams(window.location.search).get("id")},joined(){return Object.keys(this.score).includes(this.session.userId)}},methods:{boardMounted(e){this.chips=e},add(e){const s=this.chips.indexOf(e);this.found.includes(s)||(this.found.push(s),this.postPoint()),this.found.length===5&&this.postEvent("stop")},restart(){this.found=[],this.chips=[],this.boardKey+="."},connect(){n.onConnect=e=>{console.log("Connected: "+JSON.stringify(e)),n.subscribe("/topic/"+this.boardId+"/user-score",s=>{console.log("/user-score","body",s.body),this.score=JSON.parse(s.body)}),n.subscribe("/topic/"+this.boardId+"/events",s=>{switch(console.log("/events","body",s.body),s.body){case"start":this.session.playing=!0;return;case"stop":this.session.playing=!1,this.restart();return}})},n.activate()},disconnect(){n.deactivate(),console.log("Disconnected")},postPlayer(){localStorage.setItem("falcon-user-name",this.session.userName),n.publish({destination:"/board/"+this.boardId+"/player",body:JSON.stringify({id:this.session.userId,name:this.session.userName})})},postEvent(e){n.publish({destination:"/board/"+this.boardId+"/event",body:e})},postPoint(){n.publish({destination:"/board/"+this.boardId+"/score",body:this.session.userId})}}});const C={key:0,class:"game-area"},j={class:"data-area"},P={style:{width:"100%"}},E={class:"game-board"},B={key:1,class:"waiting"},M={class:"name-row"},O=["disabled"];function J(e,s,K,U,$,D){const b=y,m=f;return e.session.playing?(a(),i("div",C,[t("header",null,[l(" Find: "),(a(!0),i(c,null,u(e.chips,(o,d)=>(a(),p(b,{key:o,background:e.found.includes(d)?"chartreuse":"",content:o,size:3},{default:v(()=>[l(r(o),1)]),_:2},1032,["background","content"]))),128))]),t("section",j,[(a(!0),i(c,null,u(e.score,(o,d)=>(a(),i("div",{key:d,style:{display:"flex","flex-flow":"row wrap","justify-content":"space-between"}},[t("span",null,r(o.user.name),1),t("span",null,r(o.total),1),t("span",P,r("âœ…".repeat(o.points)),1)]))),128))]),t("section",E,[(a(),p(m,{key:e.boardKey,tiles:80,onCorrect:e.add,onMounted:e.boardMounted},null,8,["onCorrect","onMounted"]))])])):(a(),i("section",B,[t("h1",null,"Session "+r(e.boardId),1),t("section",M,[t("label",null,[l(" Name: "),k(t("input",{"onUpdate:modelValue":s[0]||(s[0]=o=>e.session.userName=o)},null,512),[[I,e.session.userName]])]),t("button",{class:"action-button",onClick:s[1]||(s[1]=(...o)=>e.postPlayer&&e.postPlayer(...o))},r(e.joined?"Change name":"Join"),1)]),t("button",{disabled:!e.joined,class:"action-button",onClick:s[2]||(s[2]=()=>e.postEvent("start"))}," Start Game ",8,O),(a(!0),i(c,null,u(e.score,(o,d)=>(a(),i("div",{key:d,style:{display:"flex","flex-flow":"row wrap","justify-content":"space-between"}},[t("span",null,r(o.user.name)+" : "+r(o.total),1)]))),128))]))}const R=_(N,[["render",J],["__scopeId","data-v-49e30b51"]]);export{R as default};
